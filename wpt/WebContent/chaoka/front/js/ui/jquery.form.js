(function($){function clickHandler(a){var b=this.form;if(b.clk=this,"image"==this.type)if(void 0!=a.offsetX)b.clk_x=a.offsetX,b.clk_y=a.offsetY;else if("function"==typeof $.fn.offset){var c=$(this).offset();b.clk_x=a.pageX-c.left,b.clk_y=a.pageY-c.top}else b.clk_x=a.pageX-this.offsetLeft,b.clk_y=a.pageY-this.offsetTop;setTimeout(function(){b.clk=b.clk_x=b.clk_y=null},10)}function submitHandler(){var a=this.formPluginId,b=$.fn.ajaxForm.optionHash[a];return $(this).ajaxSubmit(b),!1}$.fn.ajaxSubmit=function(options){function fileUpload(){function cb(){if(!cbInvoked++){io.detachEvent?io.detachEvent("onload",cb):io.removeEventListener("load",cb,!1);var ok=!0;try{if(timedOut)throw"timeout";var data,doc;if(doc=io.contentWindow?io.contentWindow.document:io.contentDocument?io.contentDocument:io.document,xhr.responseText=doc.body?doc.body.innerHTML:null,xhr.responseXML=doc.XMLDocument?doc.XMLDocument:doc,"json"==opts.dataType||"script"==opts.dataType){var ta=doc.getElementsByTagName("textarea")[0];data=ta?ta.value:xhr.responseText,"json"==opts.dataType?eval("data = "+data):$.globalEval(data)}else"xml"==opts.dataType?(data=xhr.responseXML,data||null==xhr.responseText||(data=toXml(xhr.responseText))):data=xhr.responseText}catch(e){ok=!1,$.handleError(opts,xhr,"error",e)}ok&&(opts.success(data,"success"),g&&$.event.trigger("ajaxSuccess",[xhr,opts])),g&&$.event.trigger("ajaxComplete",[xhr,opts]),g&&!--$.active&&$.event.trigger("ajaxStop"),opts.complete&&opts.complete(xhr,ok?"success":"error"),setTimeout(function(){$io.remove(),xhr.responseXML=null},100)}}function toXml(a,b){return window.ActiveXObject?(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a)):b=(new DOMParser).parseFromString(a,"text/xml"),b&&b.documentElement&&"parsererror"!=b.documentElement.tagName?b:null}var form=$form[0],opts=$.extend({},$.ajaxSettings,options),id="jqFormIO"+$.fn.ajaxSubmit.counter++,$io=$('<iframe id="'+id+'" name="'+id+'" />'),io=$io[0],op8=$.browser.opera&&9>window.opera.version();($.browser.msie||op8)&&(io.src='javascript:false;document.write("");'),$io.css({position:"absolute",top:"-1000px",left:"-1000px"});var xhr={responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){}},g=opts.global;g&&!$.active++&&$.event.trigger("ajaxStart"),g&&$.event.trigger("ajaxSend",[xhr,opts]);var cbInvoked=0,timedOut=0;setTimeout(function(){$io.appendTo("body"),io.attachEvent?io.attachEvent("onload",cb):io.addEventListener("load",cb,!1),form.encoding?"encoding":"enctype";var b=$form.attr("target");$form.attr({target:id,method:"POST",encAttr:"multipart/form-data",action:opts.url}),opts.timeout&&setTimeout(function(){timedOut=!0,cb()},opts.timeout),form.submit(),$form.attr("target",b)},10)}"function"==typeof options&&(options={success:options}),options=$.extend({url:this.attr("action")||window.location,type:this.attr("method")||"GET"},options||{});var a=this.formToArray(options.semantic);if(options.beforeSubmit&&options.beforeSubmit(a,this,options)===!1)return this;var veto={};if($.event.trigger("form.submit.validate",[a,this,options,veto]),veto.veto)return this;var q=$.param(a);"GET"==options.type.toUpperCase()?(options.url+=(options.url.indexOf("?")>=0?"&":"?")+q,options.data=null):options.data=q;var $form=this,callbacks=[];if(options.resetForm&&callbacks.push(function(){$form.resetForm()}),options.clearForm&&callbacks.push(function(){$form.clearForm()}),!options.dataType&&options.target){var oldSuccess=options.success;callbacks.push(function(a){$(options.target).attr("innerHTML",a).evalScripts().each(oldSuccess,arguments)})}else options.success&&callbacks.push(options.success);options.success=function(a,b){for(var c=0,d=callbacks.length;d>c;c++)callbacks[c](a,b,$form)};for(var files=$("input:file",this).fieldValue(),found=!1,j=0;files.length>j;j++)files[j]&&(found=!0);return options.iframe||found?fileUpload():$.ajax(options),$.event.trigger("form.submit.notify",[this,options]),this},$.fn.ajaxSubmit.counter=0,$.fn.ajaxForm=function(a){return this.ajaxFormUnbind().submit(submitHandler).each(function(){this.formPluginId=$.fn.ajaxForm.counter++,$.fn.ajaxForm.optionHash[this.formPluginId]=a,$(":submit,input:image",this).click(clickHandler)})},$.fn.ajaxForm.counter=1,$.fn.ajaxForm.optionHash={},$.fn.ajaxFormUnbind=function(){return this.unbind("submit",submitHandler),this.each(function(){$(":submit,input:image",this).unbind("click",clickHandler)})},$.fn.formToArray=function(a){var b=[];if(0==this.length)return b;var c=this[0],d=a?c.getElementsByTagName("*"):c.elements;if(!d)return b;for(var e=0,f=d.length;f>e;e++){var g=d[e],h=g.name;if(h)if(a&&c.clk&&"image"==g.type)g.disabled||c.clk!=g||b.push({name:h+".x",value:c.clk_x},{name:h+".y",value:c.clk_y});else{var i=$.fieldValue(g,!0);if(i&&i.constructor==Array)for(var j=0,k=i.length;k>j;j++)b.push({name:h,value:i[j]});else null!==i&&i!==void 0&&b.push({name:h,value:i})}}if(!a&&c.clk)for(var l=c.getElementsByTagName("input"),e=0,f=l.length;f>e;e++){var m=l[e],h=m.name;h&&!m.disabled&&"image"==m.type&&c.clk==m&&b.push({name:h+".x",value:c.clk_x},{name:h+".y",value:c.clk_y})}return b},$.fn.formSerialize=function(a){return $.param(this.formToArray(a))},$.fn.fieldSerialize=function(a){var b=[];return this.each(function(){var c=this.name;if(c){var d=$.fieldValue(this,a);if(d&&d.constructor==Array)for(var e=0,f=d.length;f>e;e++)b.push({name:c,value:d[e]});else null!==d&&d!==void 0&&b.push({name:this.name,value:d})}}),$.param(b)},$.fn.fieldValue=function(a){for(var b=[],c=0,d=this.length;d>c;c++){var e=this[c],f=$.fieldValue(e,a);null===f||void 0===f||f.constructor==Array&&!f.length||(f.constructor==Array?$.merge(b,f):b.push(f))}return b},$.fieldValue=function(a,b){var c=a.name,d=a.type,e=a.tagName.toLowerCase();if(b===void 0&&(b=!0),b&&(!c||a.disabled||"reset"==d||"button"==d||("checkbox"==d||"radio"==d)&&!a.checked||("submit"==d||"image"==d)&&a.form&&a.form.clk!=a||"select"==e&&-1==a.selectedIndex))return null;if("select"==e){var f=a.selectedIndex;if(0>f)return null;for(var g=[],h=a.options,i="select-one"==d,j=i?f+1:h.length,k=i?f:0;j>k;k++){var l=h[k];if(l.selected){var m=$.browser.msie&&!l.attributes.value.specified?l.text:l.value;if(i)return m;g.push(m)}}return g}return a.value},$.fn.clearForm=function(){return this.each(function(){$("input,select,textarea",this).clearFields()})},$.fn.clearFields=$.fn.clearInputs=function(){return this.each(function(){var a=this.type,b=this.tagName.toLowerCase();"text"==a||"password"==a||"textarea"==b?this.value="":"checkbox"==a||"radio"==a?this.checked=!1:"select"==b&&(this.selectedIndex=-1)})},$.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})}})(jQuery);