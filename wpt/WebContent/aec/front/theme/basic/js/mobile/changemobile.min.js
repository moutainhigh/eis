function sendMessage(){if($("#member_changeMoblieForm").valid()){curCount=count;var e=$("#username").val();if(""!=e){for(var a=0;codeLength>a;a++)code+=parseInt(9*Math.random()).toString();$.ajax({type:"POST",url:"/sms/register/submit/"+e+".json",data:{update:"true"},dataType:"json",success:function(e){return"102008"!=e.message.operateCode?(alert(e.message.message),!1):"102008"==e.message.operateCode?($("#btnSendCode").attr("disabled","true"),$("#btnSendCode").val("请在"+curCount+"秒内输入"),InterValObj=window.setInterval(SetRemainTime,1e3),!0):void 0},error:function(){return alert("系统繁忙,请稍后再试"),!1}})}else alert("手机号码不能为空！")}}function SetRemainTime(){0==curCount?(window.clearInterval(InterValObj),$("#btnSendCode").removeAttr("disabled"),$("#btnSendCode").val("重新发送验证码"),code=""):(curCount--,$("#btnSendCode").val("请在"+curCount+"秒内输入"))}function onchangePatchca(e){var a=Math.random(1e4);$(e).attr("src","/captcha?rd="+a)}var InterValObj,count=60,curCount,code="",codeLength=6;$(document).ready(function(){jQuery.validator.addMethod("mobile",function(e,a){var r=/^1[3|4|5|7|8]\d{9}$/;return this.optional(a)||r.test(e)},"手机格式不对"),$("#member_changeMoblieForm").validate({rules:{username:{required:!0,mobile:!0,remote:{url:"/user/exist.json",type:"POST",dataType:"json",data:{username:function(){return $("#member_changeMoblieForm input[id=username]").val()}}}}},messages:{username:{required:"请输入手机号",remote:"手机已经存在!"}},errorPlacement:function(e,a){e.insertAfter(a)},success:function(e){e.addClass("valid").text("")},submitHandler:function(){return""==$("#member_changeMoblieForm input[id=phoneBindSign]").val()?(alert("请输入短信验证码"),!1):void $.ajax({type:"POST",url:"/usr/update/data.json",data:{username:$("#member_changeMoblieForm input[id=username]").val(),uuid:$("#member_changeMoblieForm input[id=uuid]").val(),phoneBindSign:$("#member_changeMoblieForm input[id=phoneBindSign]").val()},async:!1,dataType:"json",success:function(e){switch(e.message.operateCode){case operateResultSuccess:alert("注册成功"),location.href="/content/user/pcenter.shtml";break;case operateResultFailed:alert(e.message.message),window.location.reload();break;case captchaTimeOut:alert(e.message.message);break;case errorVerifyError:alert(e.message.message);break;case errorObjectAlreadyExist:alert(e.message.message)}},error:function(){alert("系统繁忙,请稍后再试")}})}})});